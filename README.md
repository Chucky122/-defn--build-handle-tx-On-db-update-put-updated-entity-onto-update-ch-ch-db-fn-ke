# -defn--build-handle-tx-On-db-update-put-updated-entity-onto-update-ch-ch-db-fn-ke
(defn- build-handle-tx   "On db update, put updated entity onto update-ch"   [ch db]   (fn     [{:keys [tx-data]}]     (let [id (-> tx-data first first)           e (ds/entity @db (-> tx-data first first))]       (if e (go (>! ch e))))))  (defn get-updates   "Returns a channel that returns changes to db"   [f]   (let [db db-api/app-db         entity-ch (chan)         handle-tx (build-handle-tx entity-ch db)         ch (chan)]     (go-loop [entity false]              (when entity                (>! ch entity))              (recur (f (&lt;! entity-ch))))     (ds/listen! db-api/app-db (keyword (gensym "get-update-fn")) handle-tx)     ch))
